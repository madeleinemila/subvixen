
$('.pages.stage').ready(function() {

  const getFixtureId = function( node ) {
    // console.log(node.data('fid'));
    return node.data('fid');
  }

  $('body').on('change', '.f-param', function() {
      const id = getFixtureId( $(this) );
      // get which property this input relates to
      const prop = $(this).data('prop');
      // cache value
      let value = +( $(this).val() );
      // change property's value in fixture obj
      switch (prop) {
        case 'pos':
          fixtures[id].posNum = value; // no validations added here, letting user determine own numbering system that could involve decimals or neg nums
          break;
        case 'x':
          if (value < 0) {
            value = 0;
            fixtures[id].x = value;
            $(this).val( value );
          } else if (value >= vw) {
            value = vw - 1;
            fixtures[id].x = value;
            $(this).val( value );
          } else {
            fixtures[id].x = value;
          }
          break;
        case 'y':
          if (value < 0) {
            value = 0;
            fixtures[id].y = value;
            $(this).val( value );
          } else if (value >= vh) {
            value = vh - 1;
            fixtures[id].y = value;
            $(this).val( value );
          } else {
            fixtures[id].y = value;
          }
          break;
        default:
          console.log( `Invalid property data` );
      }
      // drawFixtures();
      // simCtx.clearRect(0, 0, vw, vh);
      // drawSim();
      if (overlay) {
        refreshWithOverlay();
      } else {
        refresh();
      }
  });  // end on change input



  $('body').on('click', '.f-delete', function() {
      const id = getFixtureId( $(this) );
      // find fixture to delete by fid
      const indexToDelete = _(fixtures).findIndex( {'fid': id} );
      // remove fixture
      fixtures.splice( indexToDelete, 1 ); // mutating!!
      // remove a placeholder in LUT
      lut.pop();
      // now render new view
      fixtureLog( true );
      if (overlay) {
        refreshWithOverlay();
      } else {
        refresh();
      }
  });

  $('#f-sort').on('click', function() {
    fixtureLog( true ); // sort = true
  });

}); // end doc ready

const refresh = function() { // TODO might be other occurrences that could be refactored
    drawFixtures();
    simCtx.clearRect(0, 0, vw, vh);
    drawSim();
};

const refreshWithOverlay = function() {
  drawFixtures();
  simCtx.clearRect(0, 0, vw, vh);
  drawSimOverlay();
}
